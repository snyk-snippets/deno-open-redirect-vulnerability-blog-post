import { serve } from "https://deno.land/std/http/server.ts";

const httpHandler = async (request: Request): Promise<Response> => {
  let bodyContent = "Hello World";

  const requestURL = new URL(request.url);
  const redirectTo = requestURL.searchParams.get("redirect");
  if (redirectTo) {
    return new Response(null, {
      status: 302,
      headers: {
        location: redirectTo,
      },
    });
  }

  if (requestURL.pathname === "/user") {
    bodyContent = `
        <h1> User: admin </h1>
        <ul>
          <li> Name: Roberto </li>
          <li> Email: roberto@example.com </li>
        </ul>
        `;
    return new Response(bodyContent, {
      status: 200,
      headers: {
        "content-type": "text/html",
      },
    });
  } else {
    return new Response(bodyContent, {
      status: 200,
      headers: {
        "content-type": "text/html",
      },
    });
  }
};

serve(httpHandler, { hostname: "0.0.0.0", port: 8080 });
console.log("HTTP server is running on http://localhost:8080/");
